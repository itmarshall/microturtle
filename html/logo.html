<html>
<head>
	<meta charset="utf-8">
    <title>MicroTurtle Logo</title>
	<link rel="stylesheet" type="text/css" href="/style.css"/>
    <script type="text/javascript" src="logo.min.js"></script>

</head>
<body>
	<div class="banner">
		MicroTurtle Logo
	</div>
    <pre id="editor">
; Welcome To MicroTurtle Logo!
; Common commands are shown in this sample program
pu          ; Pen up (stop drawing)
fd 10       ; Forward 10mm
rt 90       ; Turn right (clockwise) 90°
bk 20       ; Backward 20mm
lt 90       ; Turn left (anti-clockwise) 90°
pd          ; Pen down (start drawing)
make "x 2   ; Set variable "x" to 2
repeat :x [ ; Perform the following commands "x" (2) times
  square 10 ; Call procedure "square"
  rt 45     ; Turn right (clockwise) 45°
]           ; End of repeated commands
pu          ; Pen up (stop drawing)

; Draw a square of the size supplied
to square :size
	repeat 4 [
		fd :size
		rt 90
	]
end
    </pre>
    <br>
	<div class="button-bar">
		<a class="button" href="javascript:checkProgram()">Check</a>
		<a class="button" href="javascript:runProgram()">Run</a>
	</div>
    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="logo-mode.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/xcode");
        editor.setAutoScrollEditorIntoView(true);
        editor.setOption("minLines", 10);
        editor.setOption("maxLines", 100);
        editor.getSession().setTabSize(4);
        editor.getSession().setUseSoftTabs(false);
        editor.setShowPrintMargin(false);
        editor.setDisplayIndentGuides(false);
		editor.getSession().setMode("ace/mode/logo");

		function handleErrors(exceptions) {
			console.log("Exceptions found:");
			for (var ii = 0; ii < exceptions.length; ii++) {
				var e = exceptions[ii];
				console.log("line " + e.line + ":" + e.col + " " + e.message);
			}
		}

		function checkProgram() {
            // Compile the program to byte code.
            var results = logo.compileProgram();

            if (results.success) {
                // Print out the compiled bytecode.
				alert("Program is valid.");
            } else {
                // Something was wrong, print out the errors.
				handleErrors(results.exceptions);
			}

			return results;
		}

        function runProgram() {
            // Compile the program to byte code.
            var results = logo.compileProgram();

            if (results.success) {
                // Print out the compiled bytecode.
				var obj = {"program": results.bytecode};
				var xhr = new XMLHttpRequest();
				xhr.open('POST', '/runBytecode.cgi');
				xhr.onreadystatechange = function() {
					if (xhr.readyState == XMLHttpRequest.DONE) {
						console.log("Completed with status: " + xhr.status);
					}
				};
				xhr.send("code=" + JSON.stringify(obj));
            } else {
                // Something was wrong, print out the errors.
				handleErrors(results.exceptions);
				alert("Problems were found in the program, please fix.");
            }
        }
    </script>
</body>
<footer>
	© 2018 Ian Marshall
</footer>
</html>
